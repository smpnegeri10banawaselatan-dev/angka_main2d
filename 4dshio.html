<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pemangkasan Angka — Multi Angka Main</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-6 relative">
    <h1 class="text-2xl font-bold mb-4">Pemangkasan Angka — Multi Angka Main</h1>
    <p class="mb-4 text-sm text-gray-600">
      Masukkan deretan angka lalu beberapa <strong>angka main</strong> (maks 7 digit per baris, hingga 10 baris). 
      Sistem akan memangkas angka yang tidak memiliki keterikatan dengan masing-masing angka main.
    </p>

    <!-- Input angka -->
    <label class="block font-semibold mb-1">Deretan angka</label>
    <input id="sequence" type="text" 
           class="w-full border rounded-lg p-2 mb-4" 
           placeholder="Contoh: 23*32*48*84*95*123*4567" />

    <!-- Angka main multi-baris -->
    <label class="block font-semibold mb-1">Angka main (maks 7 digit per baris)</label>
    <textarea id="mainArea" rows="10"
              class="w-full border rounded-lg p-2 mb-4"
              placeholder="Contoh:\n5678\n1234567"></textarea>

    <!-- Pilihan panjang angka -->
    <label class="block font-semibold mb-1">Pilih Panjang Angka</label>
    <div class="flex flex-col gap-2 mb-4 text-sm">
      <label class="inline-flex items-center gap-2">
        <input type="radio" name="digit" value="2" checked> 2D
      </label>
      <label class="inline-flex items-center gap-2">
        <input type="radio" name="digit" value="3"> 3D
      </label>
      <label class="inline-flex items-center gap-2">
        <input type="radio" name="digit" value="4"> 4D
      </label>
    </div>

    <!-- Mode pencocokan -->
    <label class="block font-semibold mb-1">Mode pencocokan</label>
    <div class="flex flex-col gap-2 mb-4 text-sm">
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="any" checked> Any</label>
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="kepala"> Kepala</label>
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="ekor"> Ekor</label>
    </div>

    <button id="run" 
            class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg font-semibold w-full sm:w-auto">
      Jalankan Pemangkasan
    </button>

    <!-- Hasil singkat -->
    <h3 class="text-lg font-semibold mt-6 mb-2">Hasil singkat</h3>
    <div id="outShort" 
         class="bg-gray-50 border rounded-lg p-2 text-sm whitespace-pre-wrap break-words">
      <em>(belum dijalankan)</em>
    </div>

    <!-- Detail -->
    <h3 class="text-lg font-semibold mt-6 mb-2">Detail</h3>
    <div id="outDetail" class="overflow-x-auto text-sm"><em>(belum dijalankan)</em></div>
  </div>

  <script>
    function normalizeList(text){
      return text.replace(/[,;|]+/g, ' ')
                 .replace(/\*/g, ' ')
                 .trim()
                 .split(/\s+/)
                 .filter(Boolean);
    }
    function uniqueChars(s){ return [...new Set(s.split(''))]; }

    function analyze(sequenceArr, mainDigits, mode, digitLength){
      const mainSet = new Set(mainDigits);
      const kept = [];
      const rows = [];
      for(const num of sequenceArr){
        if(num.length !== digitLength) continue;
        const first = num[0];
        const last = num[num.length-1];
        const matchFirst = mainSet.has(first);
        const matchLast = mainSet.has(last);
        const anyMatch = [...num].some(ch => mainSet.has(ch));
        let take = false;
        if(mode === 'any') take = anyMatch;
        if(mode === 'kepala') take = matchFirst;
        if(mode === 'ekor') take = matchLast;
        if(take){
          kept.push(num);
          let status = 'none';
          if(matchFirst && matchLast) status = 'both';
          else if(matchFirst) status = 'kepala';
          else if(matchLast) status = 'ekor';
          rows.push({num, status});
        }
      }
      return {kept, rows};
    }

    document.getElementById('run').addEventListener('click', ()=>{
      const seqText = document.getElementById('sequence').value;
      const arr = normalizeList(seqText);
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const digitLength = parseInt(document.querySelector('input[name="digit"]:checked').value);
      const mainLines = document.getElementById('mainArea').value.split("\n");

      let outShort = "";
      let outDetail = "";

      mainLines.forEach((line, idx)=>{
        const mainText = line.trim();
        if(!mainText) return;
        if(!/^\d{1,7}$/.test(mainText)) return; // hanya digit maks 7

        const mainDigits = uniqueChars(mainText);
        const res = analyze(arr, mainDigits, mode, digitLength);

        // Hasil singkat per baris
        if(res.kept.length){
          outShort += `Main: <strong>${mainText}</strong> → <code>${res.kept.join('*')}</code> <span class="text-xs text-gray-500">(${res.kept.length} angka)</span>\n\n`;
        } else {
          outShort += `Main: <strong>${mainText}</strong> → <em>Tidak ada yang cocok</em>\n\n`;
        }

        // Detail per baris
        if(res.rows.length){
          outDetail += `<h4 class="font-semibold mt-4 mb-2">Main: ${mainText}</h4>`;
          outDetail += '<table class="min-w-full border text-sm table-auto break-words mb-4"><thead><tr class="bg-gray-100"><th class="p-2 border">Angka</th><th class="p-2 border">Jenis</th></tr></thead><tbody>';
          for(const r of res.rows){
            const status = r.status === 'both' ? 'Kepala & Ekor' : r.status;
            outDetail += `<tr>
              <td class="border p-2">${r.num}</td>
              <td class="border p-2">${status}</td>
            </tr>`;
          }
          outDetail += '</tbody></table>';
        }
      });

      document.getElementById('outShort').innerHTML = outShort || '<em>Tidak ada yang cocok</em>';
      document.getElementById('outDetail').innerHTML = outDetail || '<em>Tidak ada yang cocok</em>';
    });

    // Auto run awal
    document.getElementById('run').click();
  </script>
</body>
</html>
