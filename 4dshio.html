<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pemangkasan Angka + Filter Shio</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-3xl mx-auto bg-white shadow-lg rounded-2xl p-6 relative">
    <h1 class="text-2xl font-bold mb-4">Pemangkasan Angka + Filter Shio</h1>

    <!-- Input -->
    <label class="block font-semibold mb-1">Deretan angka</label>
    <input id="sequence" type="text" placeholder="Contoh: 23*32*48*84*95" class="w-full border rounded-lg p-2 mb-4" />

    <label class="block font-semibold mb-1">Angka main (max 7 digit)</label>
    <input id="main" type="text" maxlength="7" placeholder="Contoh: 5678" class="w-full border rounded-lg p-2 mb-4" />

    <label class="block font-semibold mb-1">Mode pencocokan</label>
    <div class="flex flex-col gap-2 mb-4 text-sm">
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="any" checked> Any</label>
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="kepala"> Kepala</label>
      <label class="inline-flex items-center gap-2"><input type="radio" name="mode" value="ekor"> Ekor</label>
    </div>

    <label class="block font-semibold mb-1">Filter Shio</label>
    <div class="flex gap-2 mb-4">
      <select id="shioSelect" multiple size="6" class="flex-1 border rounded-lg p-2">
        <option value="1">Shio 1</option>
        <option value="2">Shio 2</option>
        <option value="3">Shio 3</option>
        <option value="4">Shio 4</option>
        <option value="5">Shio 5</option>
        <option value="6">Shio 6</option>
        <option value="7">Shio 7</option>
        <option value="8">Shio 8</option>
        <option value="9">Shio 9</option>
        <option value="10">Shio 10</option>
        <option value="11">Shio 11</option>
        <option value="12">Shio 12</option>
      </select>
      <button id="resetShio" class="bg-gray-200 hover:bg-gray-300 text-sm px-3 py-1 rounded-lg">Reset</button>
    </div>

    <button id="run" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg font-semibold">Proses</button>

    <!-- Output -->
    <h3 class="text-lg font-semibold mt-6 mb-2">Hasil singkat</h3>
    <div class="flex items-start gap-2">
      <div id="outShort" class="bg-gray-50 border rounded-lg p-2 text-sm flex-1 whitespace-pre-wrap break-words"><em>(belum dijalankan)</em></div>
      <button id="copyBtn" class="bg-gray-200 hover:bg-gray-300 text-sm px-3 py-1 rounded-lg">Salin</button>
    </div>

    <h3 class="text-lg font-semibold mt-6 mb-2">Detail</h3>
    <div id="outDetail" class="overflow-x-auto text-sm"><em>(belum dijalankan)</em></div>

    <!-- Toast -->
    <div id="toast" class="hidden fixed bottom-4 right-4 bg-teal-600 text-white px-4 py-2 rounded-lg shadow-lg text-sm">Hasil disalin!</div>
  </div>

  <script>
    // --- Helper ---
    function normalizeList(text){
      return text.replace(/[,;|]+/g, ' ')
                 .replace(/\*/g, ' ')
                 .trim()
                 .split(/\s+/)
                 .filter(Boolean);
    }
    function uniqueChars(s){ return [...new Set(s.split(''))]; }

    // Generate list angka untuk setiap Shio (1â€“12)
    function generateShioNumbers(){
      const shioMap = {};
      for(let s=1; s<=12; s++){
        shioMap[s] = [];
        for(let base=s; base<100; base+=12){
          shioMap[s].push(base.toString().padStart(2,'0'));
        }
      }
      return shioMap;
    }
    const shioData = generateShioNumbers();

    // Analisis
    function analyze(sequenceArr, mainDigits, mode, selectedShio){
      const mainSet = new Set(mainDigits);
      const kept = [];
      const rows = [];

      for(const num of sequenceArr){
        const first = num[0];
        const last = num[num.length-1];
        const matchFirst = mainSet.has(first);
        const matchLast = mainSet.has(last);
        const anyMatch = [...num].some(ch => mainSet.has(ch));
        let take = false;
        if(mode === 'any') take = anyMatch;
        if(mode === 'kepala') take = matchFirst;
        if(mode === 'ekor') take = matchLast;

        if(take){
          // Filter shio
          let shioOk = true;
          if(selectedShio.length > 0){
            shioOk = selectedShio.some(s => shioData[s].includes(num));
          }
          if(!shioOk) continue;

          kept.push(num);
          let status = 'none';
          if(matchFirst && matchLast) status = 'Kepala & Ekor';
          else if(matchFirst) status = 'Kepala';
          else if(matchLast) status = 'Ekor';

          const matchedDigits = [];
          for(const ch of uniqueChars(num)){
            if(mainSet.has(ch)){
              const pos = [];
              if(num[0] === ch) pos.push('Kepala');
              if(num[num.length-1] === ch) pos.push('Ekor');
              matchedDigits.push({digit: ch, pos});
            }
          }
          rows.push({num, status, matchedDigits});
        }
      }
      return {kept, rows};
    }

    // Event Proses
    document.getElementById('run').addEventListener('click', ()=>{
      const seqText = document.getElementById('sequence').value;
      const mainText = document.getElementById('main').value;
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const arr = normalizeList(seqText);
      const mainDigits = uniqueChars(mainText);

      // Ambil shio yang dipilih
      const shioSelect = document.getElementById('shioSelect');
      const selectedShio = Array.from(shioSelect.selectedOptions).map(o => o.value);

      const res = analyze(arr, mainDigits, mode, selectedShio);

      // Hasil singkat
      if(res.kept.length){
        document.getElementById('outShort').innerHTML =
          `<code>${res.kept.join('*')}</code><br><strong>Jumlah: ${res.kept.length}</strong>`;
      } else {
        document.getElementById('outShort').innerHTML = '<em>Tidak ada yang cocok</em>';
      }

      // Detail
      if(res.rows.length === 0){
        document.getElementById('outDetail').innerHTML = '<em>Tidak ada angka yang cocok.</em>';
        return;
      }
      let html = '<table class="min-w-full border text-sm table-auto break-words">';
      html += '<thead><tr class="bg-gray-100"><th class="p-2 border">Angka</th><th class="p-2 border">Jenis</th><th class="p-2 border">Digit Cocok</th></tr></thead><tbody>';
      for(const r of res.rows){
        const matchedText = r.matchedDigits.map(m => `${m.digit} (${m.pos.join(',')})`).join(', ');
        html += `<tr>
          <td class="border p-2">${r.num}</td>
          <td class="border p-2">${r.status}</td>
          <td class="border p-2">${matchedText}</td>
        </tr>`;
      }
      html += '</tbody></table>';
      document.getElementById('outDetail').innerHTML = html;
    });

    // Copy
    document.getElementById('copyBtn').addEventListener('click', ()=>{
      const text = document.getElementById('outShort').innerText;
      if(text){
        navigator.clipboard.writeText(text).then(()=>{
          const toast = document.getElementById('toast');
          toast.classList.remove('hidden');
          setTimeout(()=> toast.classList.add('hidden'), 2000);
        });
      }
    });

    // Reset Shio
    document.getElementById('resetShio').addEventListener('click', ()=>{
      const shioSelect = document.getElementById('shioSelect');
      Array.from(shioSelect.options).forEach(opt => opt.selected = false);
    });
  </script>
</body>
</html>
